{
  "active": true,
  "connections": {
    "Shopify Trigger": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Microsoft Outlook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Microsoft Outlook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-01-17T01:42:03.881Z",
  "id": "jrV6IfYlQ7NjO0rS",
  "meta": null,
  "name": "New order sends an email",
  "nodes": [
    {
      "parameters": {
        "toRecipients": "={{ $json.contact_email }}",
        "subject": "üéôÔ∏è Capture the Magic: Record Your Custom Greeting for the Big Day with Voice Keepsakes!",
        "bodyContent": "=<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Wedding Audio Greeting</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 0;\n            background-color: #f0f0f0;\n            padding-bottom: 1rem;\n        }\n\n        .container {\n            max-width: 600px;\n            margin: 20px auto;\n            padding: 20px;\n            background-color: #ffffff;\n            border-radius: 8px;\n            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n        }\n\n        .banner {\n            background-color: #123740;\n            text-align: center;\n            padding: 10px 0;\n            border-radius: 8px 8px 0 0; \n        }\n\n        .banner h2 {\n            color: #ffffff;\n            margin: 0;\n        }\n\n        h3 {\n            color: #123740;\n        }\n\n        p {\n            color: #333333;\n            line-height: 1.6;\n        }\n\n        a {\n            color: #006400;\n            text-decoration: none;\n        }\n\n        a:hover {\n            text-decoration: underline;\n        }\n\n        .button {\n            display: inline-block;\n            padding: 10px 20px;\n            background-color: #123740;\n            color: #ffffff;\n            text-decoration: none;\n            margin-bottom: 15px;\n            border-radius: 5px;\n            transition: background-color 0.2s ease; /* Add smooth color transition on hover */\n        }\n        .button:hover {\n            background-color: #0c2227; /* Darker green on hover */\n        }\n\n        .message-examples {\n            margin-top: 20px;\n            color: #555555;\n        }\n\n\n        .signature {\n            margin-top: 40px;\n            text-align: right;\n        }\n        \n        .test {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            justify-content: flex-end; /* Align content to the right */\n        }\n\n        .signature p {\n            font-size: 14px;\n            color: #333333;\n            line-height: 0;\n        }\n\n        .signature span {\n            display: inline-block;\n            margin-right: 10px;\n        }\n\n        .signature img {\n            height: 20px;\n            width: auto;\n            padding-bottom: 4px;\n            padding-right: 4px;\n        }\n        \n        .record-button-div {\n            display: flex;\n            justify-content: center;\n        }\n\n    </style>\n</head>\n<body>\n    <div class=\"banner\">\n        <h2>Voice Keepsakes</h2>\n<img src=\"https://i.ibb.co/87kzVTK/test.png\">\n\n    </div>\n    <div class=\"container\">\n        <h3>Hey {{ $('Shopify Trigger').item.json.customer.first_name }} üëã,</h3>\n        <p>Thank you so much for choosing Voice Keepsakes for your audio guest book! As part of this delightful experience, we invite you to create a custom greeting that will warmly welcome your guests when they pick up the phone. Your personal touch will undoubtedly make the moments even more special. <br />You have the flexibility to complete this closer to the event date, and rest assured, we'll send you friendly reminder emails. Alternatively, you can take care of it now and enjoy peace of mind, knowing it's all sorted.</p>\n        <div class=\"record-button-div\"><a href=\"https://voice-recorder-53502.web.app/?orderId={{ $json.encodedOrderNumber }}\" target=\"_blank\" class=\"button\">Record Your Message</a></div>\n        <p>If you could do this by <b>{{ $input.item.json.uploadDeadline }}</b>, then we can load this on your phone and get it to you in\n            time for your event on the {{ $input.item.json.delDate }} üôÇ </p>\n\n        <div class=\"message-examples\">\n            <p>Here are some examples if you need some help with what kind of things to say,</p>\n            <ul>\n                <li>\"Hello, dear friends and family! Thank you for being a part of our special day. We are so grateful\n                    to have you here celebrating with us. Please leave a message with your thoughts, wishes, or advice\n                    for us after the beep. We can't wait to hear your voices and cherish these memories forever.\"</li>\n                <li>\"Hey there, amazing people! We're overjoyed that you're here to celebrate this magical day with us.\n                    Leave us a message after the beep, and don't hold back! Share your well wishes, funny stories, or\n                    any advice you have for us. We promise to cherish every word and maybe even have a laugh or two\n                    along the way!\"</li>\n                <li>\"Hello, everyone! Your presence means the world to us. We're so happy to have you here as we start\n                    this incredible journey together. Share your love, your hopes, or any wisdom you'd like to pass on\n                    after the beep. Your words will be a treasure for us, and we can't thank you enough for being a part\n                    of our special day.\"</li>\n                <li>\"Hey, friends and family! It's us, [Couple's Names]. We're beyond excited to have you here, and we'd\n                    love to hear your thoughts, stories, or any crazy advice you have for us. Don't be shy; be as\n                    creative and unique as you'd like! After the beep, leave your message, and we can't wait to listen\n                    and laugh together later. Thanks for being awesome!\"</li>\n            </ul>\n        </div>\n\n        <p>Just reply to this email if you need any help or have any questions üòÑ</p>\n        <div class=\"signature\">\n            <p>\n                <span>Kind regards,</span>\n            </p>\n            <div class=\"test\">\n                <img src=\"https://i.ibb.co/pvd4WSb/test-1.png\">\n                <p><span>Voice Keepsakes</span></p>\n            </div>\n        </div>\n    </div>\n</body>\n</html> ",
        "additionalFields": {
          "bccRecipients": "wade@voicekeepsakes.com.au",
          "bodyContentType": "html"
        }
      },
      "id": "2848d13c-fc50-4585-b924-f106c5933497",
      "name": "Microsoft Outlook",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1360,
        360
      ],
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kk1sPj8USL1RL0GY",
          "name": "Microsoft Outlook account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "topic": "orders/create"
      },
      "id": "d167bd7c-2994-46d1-ab9e-4dbfa76c4fac",
      "name": "Shopify Trigger",
      "type": "n8n-nodes-base.shopifyTrigger",
      "typeVersion": 1,
      "position": [
        60,
        380
      ],
      "webhookId": "35eaf535-a0e3-4b94-a473-bd738949dd6e",
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "zKYJyGyRGR4R2Vmm",
          "name": "Shopify Access Token account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "This one is shitty because the trigger works but i cant test it here. so i've pineed some data to the trigger output to test",
        "height": 176,
        "width": 524
      },
      "id": "e37ebc0a-1d1c-4f1d-8bf1-ed11d523675e",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        280,
        100
      ]
    },
    {
      "parameters": {
        "content": "On new order we should send an email on where they can upload their audio recordings",
        "height": 176,
        "width": 524
      },
      "id": "e9168886-24fe-448f-9f2c-29a5dca2f521",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        840,
        120
      ]
    },
    {
      "parameters": {
        "content": "TODO:\n- lots of things",
        "height": 176,
        "width": 524
      },
      "id": "687627d5-12ec-425f-b069-926d9f731ed1",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1040,
        700
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Add a new field called 'myNewField' to the JSON of the item\nfunction base64Encode(str) {\n  const buffer = Buffer.from(str, 'utf-8');\n  return buffer.toString('base64');\n}\n$input.item.json.encodedOrderNumber = base64Encode($input.item.json.order_number.toString())\nreturn $input.item;"
      },
      "id": "5e759d46-f4b3-46ce-bfbe-1e9ca63b5919",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        360
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function formatDate(inputDate) {\n    const months = [\n      'January', \n      'February', \n      'March', \n      'April', \n      'May', \n      'June', \n      'July', \n      'August', \n      'September', \n      'October', \n      'November', \n      'December'\n    ];\n    \n    const dateParts = inputDate.split('/');\n    const year = dateParts[0];\n    const month = months[parseInt(dateParts[1], 10) - 1];\n    const day = parseInt(dateParts[2], 10);\n\n    const ordinalSuffix = (day) => {\n        if (day >= 11 && day <= 13) {\n            return 'th';\n        }\n        switch (day % 10) {\n            case 1:\n                return 'st';\n            case 2:\n                return 'nd';\n            case 3:\n                return 'rd';\n            default:\n                return 'th';\n        }\n    };\n\n    const formattedDate = `the ${day}${ordinalSuffix(day)} of ${month} ${year}`;\n    return formattedDate;\n}\n\nconst deadline = new Date($input.item.json.formattedDate);\ndeadline.setDate(deadline.getDate() - 12);\n// $input.item.json.test34 = deadline.toISOString().split('T')[0].replaceAll('-', '/')\n\n$input.item.json.uploadDeadline = formatDate(deadline.toISOString().split('T')[0].replaceAll('-', '/'));\n$input.item.json.delDate = formatDate($input.item.json.formattedDate);\n\nreturn $input.item;"
      },
      "id": "2dd67a7f-09f7-497a-9109-0c64d3b6652b",
      "name": "Code1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        360
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function formatDate(inputDate) {\n  // Create a Date object from the input date string\n  const dateObject = new Date(inputDate);\n  if (isNaN(dateObject)){\n    return null\n  }\n  \n\n  // Extract year, month, and day components\n  const year = dateObject.getFullYear();\n  const month = String(dateObject.getMonth() + 1).padStart(2, '0'); // Months are zero-based\n  const day = String(dateObject.getDate()).padStart(2, '0');\n\n  // Create the formatted date string in \"yyyy-mm-dd\" format\n  const formattedDate = `${year}/${month}/${day}`;\n\n  return formattedDate;\n}\n\n// Example usage:\nconst tags = $('Shopify Trigger').item.json.tags.split(','); //tags are split by ',' in shopify\nconst result = tags.map((tag) => formatDate(tag))\nconst filteredArray = result.filter(value => value !== null);\n\nif(filteredArray.length != 1){\n  $input.item.json.formattedDate = null\n}\nelse {\n  $input.item.json.formattedDate = filteredArray[0]\n}\n\n\n// const formattedDateString = formatDate(inputDateString);\n// $input.item.json.formattedDate = result\n// return { filteredArray, tags }\nreturn $input.item;"
      },
      "id": "8c383125-d678-4893-ad06-fcf69f7dafd8",
      "name": "Code2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        280,
        380
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "784ff6f3-f35b-4f6d-9b87-602de99415fa",
              "leftValue": "={{ $json.formattedDate }}",
              "rightValue": 1,
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "looseTypeValidation": true
        }
      },
      "id": "c72b3e0b-aecb-43a1-a049-b075ec23cf5d",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        500,
        380
      ],
      "retryOnFail": true
    },
    {
      "parameters": {
        "toRecipients": "heweywade@hotmail.com",
        "subject": "New order sends email - something went wrong",
        "bodyContent": "={{ $('Shopify Trigger').item.json.order_number }}",
        "additionalFields": {}
      },
      "id": "48050db9-82fa-4562-8c55-9a56fd0faddf",
      "name": "Microsoft Outlook1",
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        680,
        540
      ],
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kk1sPj8USL1RL0GY",
          "name": "Microsoft Outlook account"
        }
      }
    }
  ],
  "pinData": {
    "Shopify Trigger": [
      {
        "json": {
          "id": 5667062448420,
          "admin_graphql_api_id": "gid://shopify/Order/5667062448420",
          "app_id": 1354745,
          "browser_ip": "122.199.33.41",
          "buyer_accepts_marketing": false,
          "cancel_reason": null,
          "cancelled_at": null,
          "cart_token": null,
          "checkout_id": 37182890410276,
          "checkout_token": "78aa737e58ed12d263950c4f390904d7",
          "client_details": {
            "accept_language": null,
            "browser_height": null,
            "browser_ip": "122.199.33.41",
            "browser_width": null,
            "session_hash": null,
            "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
          },
          "closed_at": null,
          "confirmation_number": "PV0WY78HY",
          "confirmed": true,
          "contact_email": null,
          "created_at": "2024-01-17T13:00:19+10:30",
          "currency": "AUD",
          "current_subtotal_price": "0.00",
          "current_subtotal_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "current_total_additional_fees_set": null,
          "current_total_discounts": "0.00",
          "current_total_discounts_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "current_total_duties_set": null,
          "current_total_price": "0.00",
          "current_total_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "current_total_tax": "0.00",
          "current_total_tax_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "customer_locale": "en",
          "device_id": null,
          "discount_codes": [],
          "email": "",
          "estimated_taxes": false,
          "financial_status": "paid",
          "fulfillment_status": null,
          "landing_site": null,
          "landing_site_ref": null,
          "location_id": 86684926244,
          "merchant_of_record_app_id": null,
          "name": "#1016",
          "note": null,
          "note_attributes": [],
          "number": 16,
          "order_number": 1016,
          "order_status_url": "https://voicekeepsakes.com.au/78539129124/orders/8b4cfd613258864973e86ab7cd050dc7/authenticate?key=47c63fb1d0370a71d913032c18df5e44",
          "original_total_additional_fees_set": null,
          "original_total_duties_set": null,
          "payment_gateway_names": [],
          "phone": null,
          "po_number": null,
          "presentment_currency": "AUD",
          "processed_at": "2024-01-17T13:00:19+10:30",
          "reference": "4ea35b7021c6dfd74d2755dcd2c7d7b1",
          "referring_site": null,
          "source_identifier": "4ea35b7021c6dfd74d2755dcd2c7d7b1",
          "source_name": "shopify_draft_order",
          "source_url": null,
          "subtotal_price": "0.00",
          "subtotal_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "tags": "Sat Apr 13 2024",
          "tax_exempt": false,
          "tax_lines": [],
          "taxes_included": true,
          "test": false,
          "token": "8b4cfd613258864973e86ab7cd050dc7",
          "total_discounts": "0.00",
          "total_discounts_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "total_line_items_price": "0.00",
          "total_line_items_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "total_outstanding": "0.00",
          "total_price": "0.00",
          "total_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "total_shipping_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "total_tax": "0.00",
          "total_tax_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "AUD"
            }
          },
          "total_tip_received": "0.00",
          "total_weight": 0,
          "updated_at": "2024-01-17T13:00:20+10:30",
          "user_id": 99699032356,
          "billing_address": null,
          "customer": null,
          "discount_applications": [],
          "fulfillments": [],
          "line_items": [
            {
              "id": 14476769755428,
              "admin_graphql_api_id": "gid://shopify/LineItem/14476769755428",
              "attributed_staffs": [],
              "current_quantity": 1,
              "fulfillable_quantity": 1,
              "fulfillment_service": "manual",
              "fulfillment_status": null,
              "gift_card": false,
              "grams": 0,
              "name": "test",
              "price": "0.00",
              "price_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "AUD"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "AUD"
                }
              },
              "product_exists": false,
              "product_id": null,
              "properties": [],
              "quantity": 1,
              "requires_shipping": true,
              "sku": null,
              "taxable": true,
              "title": "test",
              "total_discount": "0.00",
              "total_discount_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "AUD"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "AUD"
                }
              },
              "variant_id": null,
              "variant_inventory_management": null,
              "variant_title": null,
              "vendor": "",
              "tax_lines": [],
              "duties": [],
              "discount_allocations": []
            }
          ],
          "payment_terms": null,
          "refunds": [],
          "shipping_address": null,
          "shipping_lines": []
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Shopify Trigger": {
      "webhookId": 1457451368740
    }
  },
  "tags": [
    {
      "createdAt": "2024-01-19T06:29:17.907Z",
      "updatedAt": "2024-01-19T06:29:17.907Z",
      "id": "9Wlg3x6juVGk3V4C",
      "name": "triggered"
    },
    {
      "createdAt": "2024-01-25T22:38:44.923Z",
      "updatedAt": "2024-01-25T22:38:44.923Z",
      "id": "ABAeIm9fPam1wo4P",
      "name": "done"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-01-25T22:38:47.000Z",
  "versionId": "a3af8d34-fe26-454f-b1c4-6e71ec4aed95"
}